generator client {
  provider        = "prisma-client-js"
  output          = "../node_modules/@prisma/client-uif"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("UIF_DATABASE_URL")
  schemas  = ["auth", "public"]
}

model clients {
  id                String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String
  cuit              String?
  status            String?     @default("Activo")
  person_type       String      @default("PF")
  financial_data    Json        @default("{}")
  analysis_settings Json        @default("{}")
  created_at        DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?   @default(now()) @db.Timestamptz(6)
  
  documents         documents[]
  analyses          analyses[]

  @@schema("public")
}

model documents {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id         String    @db.Uuid
  analysis_id       String?   @db.Uuid
  doc_type          String
  storage_bucket    String?   @default("documents")
  storage_path      String
  original_filename String?
  mime_type         String?
  status            String?   @default("Pendiente")
  extracted_data    Json?
  reviewed_data     Json?
  error_message     String?
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  processed_at      DateTime? @db.Timestamptz(6)
  
  client            clients   @relation(fields: [client_id], references: [id], onDelete: Cascade)
  analysis          analyses? @relation(fields: [analysis_id], references: [id], onDelete: SetNull)

  @@schema("public")
}

model analyses {
  id                String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id         String      @db.Uuid
  name              String
  status            String?     @default("En Proceso")
  financial_data    Json        @default("{}")
  analysis_settings Json        @default("{}")
  created_at        DateTime    @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  updated_at        DateTime    @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  
  client            clients     @relation(fields: [client_id], references: [id], onDelete: Cascade)
  documents         documents[]

  @@schema("public")
}

model system_settings {
  id                     Int      @id @default(1)
  monotributo_categories Json     @default("{}")
  analysis_weights       Json     @default("{}")
  extra_settings         Json     @default("{}")
  updated_at             DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)

  @@schema("public")
}
