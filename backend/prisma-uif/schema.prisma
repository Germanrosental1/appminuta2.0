generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client-uif"
}

datasource db {
  provider = "postgresql"
  url      = env("UIF_DATABASE_URL")
}

model clients {
  id                String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String
  cuit              String?
  status            String?     @default("Activo")
  person_type       String      @default("PF") // PF | PJ
  financial_data    Json        @default("{}")
  analysis_settings Json        @default("{}")
  created_at        DateTime    @default(now()) @db.Timestamptz(6)
  updated_at        DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  
  documents         documents[]
  analyses          analyses[]
}

model documents {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id         String    @db.Uuid
  analysis_id       String?   @db.Uuid
  doc_type          String
  storage_bucket    String?   @default("documents")
  storage_path      String
  original_filename String?
  mime_type         String?
  status            String?   @default("Pendiente")
  extracted_data    Json?
  reviewed_data     Json?
  error_message     String?
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  processed_at      DateTime? @db.Timestamptz(6)
  
  client            clients   @relation(fields: [client_id], references: [id], onDelete: Cascade)
  analysis          analyses? @relation(fields: [analysis_id], references: [id], onDelete: SetNull)
}

model analyses {
  id                String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id         String      @db.Uuid
  name              String
  status            String?     @default("En Proceso")
  financial_data    Json        @default("{}")
  analysis_settings Json        @default("{}")
  created_at        DateTime    @default(now()) @db.Timestamptz(6)
  updated_at        DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  
  client            clients     @relation(fields: [client_id], references: [id], onDelete: Cascade)
  documents         documents[]
}

// System settings for monotributo categories, etc.
model system_settings {
  id         String   @id @default("default")
  settings   Json     @default("{}")
  updated_at DateTime @default(now()) @updatedAt @db.Timestamptz(6)
}
